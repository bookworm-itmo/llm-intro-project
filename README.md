# RAG Чат-бот по роману "Мастер и Маргарита"

Проект для курса "Введение в LLM" - система ответов на вопросы по роману М.А. Булгакова.

## Источник данных

**Книга**: Михаил Булгаков - "Мастер и Маргарита"

**Источник**: [Флибуста](https://flibusta.is/b/813954) (формат FB2)

## Процесс сбора и подготовки данных

1. **Парсинг FB2** - извлечение текста из XML-структуры
2. **Разбиение на главы** - определение границ глав по заголовкам
3. **Chunking** - разбиение на фрагменты ~300 символов с перекрытием 30
4. **Эмбеддинги** - векторные представления через GigaChatEmbeddings (1024 измерения)
5. **Индексация** - построение FAISS IndexFlatL2 для поиска

## Структура данных

Все данные хранятся в папке [`data/`](data/):

```
data/
├── master_and_margarita.fb2   # Исходная книга
├── chunks.json                # Чанки с метаданными
└── faiss_index/
    └── index.faiss            # Векторный индекс
```

### Формат chunks.json

```json
{
  "id": 0,
  "text": "Однажды весною, в час небывало жаркого заката...",
  "chapter": 1,
  "start_char": 0,
  "end_char": 500
}
```

## Объем данных

| Метрика | Значение |
|---------|----------|
| Исходный текст | ~580 000 символов |
| Количество глав | 32 + эпилог |
| Количество чанков | 9 358 |

## Сэмпл данных

**Глава 1:**
```
Однажды весною, в час небывало жаркого заката, в Москве, на Патриарших
прудах, появились два гражданина. Первый из них, одетый в летнюю серенькую
пару, был маленького роста, упитан, лыс...
```

**Глава 13:**
```
Маргарита Николаевна со своим мужем вдвоем занимали весь верх прекрасного
особняка в саду в одном из переулков близ Арбата. Очаровательное место!
```

## Быстрый старт

```bash
pip install -r requirements.txt
streamlit run frontend/app.py
```

Или через Docker:
```bash
docker-compose up frontend
```

Требуется `.env` с ключами:
```
CLAUDE_API_KEY=...
GIGACHAT_AUTH_KEY=...
```

## Структура репозитория

```
.
├── data/                       # Данные
├── services/
│   ├── data_service/           # Парсинг и chunking
│   ├── rag_service/            # Эмбеддинги и FAISS
│   └── llm_service/            # Claude API
├── frontend/                   # Streamlit UI
├── validation/                 # Оценка качества RAG
├── prepare_data.py             # Скрипт подготовки
└── requirements.txt
```
